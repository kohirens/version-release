version: 2.1

orbs:
  vro: << pipeline.parameters.orb_repo >>@<<pipeline.parameters.dev-orb-version>>

parameters:
  dev-orb-version:
    description: >
      The development version of the orb to test.
      This value is automatically adjusted by the "trigger-integration-tests-workflow" job to correspond with the specific version created by the commit and should not be edited.
      A "dev:alpha" version must exist for the initial pipeline run.
    type: string
    default: "dev:alpha"
  orb_repo:
    description: Orb repository
    type: string
    default: "kohirens/version-release"
  continued_automation:
    description: Automation workflow description
    type: string
    default: ""

main-filter: &branches-to-skip
    branches:
      ignore: /main|updated-changelog-skip-ci|auto-update-changelog/

jobs:
  integration-test:
    executor: vro/default
    steps:
      - checkout
      - run:
          command: |
            repoPath="/tmp/repo-01"
            git clone -b main src/tests/data/repo-01.bundle ${repoPath}
            git status
            cp -R src/tests/data/.chglog ${repoPath}
            ls -la ${repoPath}
            cd ${repoPath}
      - vro/git-chglog-update:
          chglog_config_file: "src/tests/data/.chglog/config.yml"
          changelog_file: "CHANGELOG-4000.md"

workflows:
  test-orb:
    jobs:
      - integration-test:
          filters: *branches-to-skip