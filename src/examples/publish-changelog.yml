description: >
  Commit changes to the changelog and merge into a remote branch.
usage:
  version: 2.1

  orbs:
    vro: kohirens/version-release@latest

  parameters:
    ssh_finger:
      description: SSH fingerprint.
      type: string
      default: "aa:bb:cc:dd:12:34:56"
    triggered_by_bot:
      description: Trigger publishing a release tag workflow.
      type: boolean
      default: false

  workflows:
    version: 2
    auto-release: # Run ONLY on main and when triggered_by_bot is true via an API call.
      when:
        and:
          - equal: [main, << pipeline.git.branch >>]
          - << pipeline.parameters.triggered_by_bot >>
      jobs:
        - vro/publish-changelog:
            context: orb-publishing
            filters: { branches: { only: main } }
            pre-steps:
              - checkout
              - attach_workspace: { at: '.' }
              - run: echo "trigger source << pipeline.trigger_source >>"
            ssh_finger: << pipeline.parameters.ssh_finger >>
