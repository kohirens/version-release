description: |2
  GitHub Has Release.

parameters:
  attach_workspace_path:
    default: "."
    description: Set where to attach the workspace.
    type: string
  do_attach_workspace:
    default: false
    description: |2
      Set this to `true` to attaching the workspace or false to skip this step.
    type: boolean
  do_checkout:
    description: In case you need to customize.
    type: boolean
    default: true
  exec_img_tag:
    default: "VERSION_RELEASE_IMAGE"
    description: Version of the executor image to pull.
    type: string
  file:
    default: "has-release.txt"
    description: File containing the answer if the release was found or not.
    type: string
  github_token_var:
    default: GH_TOKEN
    description: Name of the environment variable holding the GitHub API token.
    type: env_var_name
  ssh_finger:
    description: |2
      Fingerprint of an SSH key that can be used to perform a merge into a
      branch.
    type: string
  owner:
      description: GitHub organization containing the repository to check.
      type: string
  repo:
      description: GitHub repository to check.
      type: string
  tag:
      description: GitHub release to lookup.
      type: string

executor:
  name: default
  exec_img_tag: <<parameters.exec_img_tag>>

steps:
  - when:
      condition: <<parameters.do_checkout>>
      steps:
        - checkout
  - when:
      condition: <<parameters.do_attach_workspace>>
      steps:
         - attach_workspace:
             at: <<parameters.attach_workspace_path>>
  - add_ssh_keys:
      fingerprints:
        - <<parameters.ssh_finger>>
  - run:
      environment:
        PARAM_OWNER: <<parameters.owner>>
        PARAM_REPO: <<parameters.repo>>
        PARAM_TAG: <<parameters.tag>>
        PARAM_FILE: <<parameters.file>>
      name: Select which workflow to execute when code is merged into main.
      command: << include(scripts/gh-has-release.sh) >>
  - persist_to_workspace: { root: .,  paths: [ <<parameters.file>> ] }
